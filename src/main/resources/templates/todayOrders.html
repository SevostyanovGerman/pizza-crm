<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Today orders</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"
          th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          th:href="@{/webjars/font-awesome/css/font-awesome.min.css}"
          rel="stylesheet" media="screen"/>
    <link th:href="@{/css/todayOrdersStyles.css}"
          href="../static/css/todayOrdersStyles.css"
          rel="stylesheet" media="screen">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js"
            th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.77/jquery.form-validator.min.js"></script>
    <script src="../static/js/order.js" th:src="@{/js/order.js}"></script>
</head>

<body>
<section>
    <div class="row header">
        <div class="col-4">
            <p>Pizza CRM</p>
            <p class="clock-date ml-4 mr-2"></p>
            <p class="clock-hours mx-0 px-0"></p>
            <p class="clock-colon mx-0 px-0">:</p>
            <p class="clock-minutes mx-0 px-0"></p>
        </div>
        <div class="col offset-7 no-margin">
            <p class="header-right">Юлия Савенко</p>
            <span></span>
        </div>
    </div>
    <div class="header-menu">
        <a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a>
        <a href="/logout" th:href="@{/logout}"><i class="fa fa-lock" aria-hidden="true"></i></a>
    </div>
    <div class="row">
        <!-- left-panel -->
        <div class="col-4 no-margin left-panel">
            <div class="left-panel-header">
                <div class="row">
                    <div class="col-3 left-panel-header-item-1">
                        <p><i class="fa fa-align-justify" aria-hidden="true"></i></p>
                    </div>
                    <div class="col-3 left-panel-header-item-2">
                        <p id="orderTime"></p>
                        <p></p>
                    </div>
                    <div class="col-3 left-panel-header-item-3">
                        <p><i class="fa fa-list-alt" aria-hidden="true"></i></p>
                        <p>8567</p>
                    </div>
                    <div class="col-3 left-panel-header-item-3">
                        <p><i class="fa fa-id-card" aria-hidden="true"></i></p>
                        <p>Юлия Савенко</p>
                    </div>
                </div>
                <!--Current order table-->
                <div class="left-panel-body" style="overflow: auto">
                    <table class="table table-sm table-condensed order-table"></table>
                </div>
                <div class="left-panel-body-1">
                    <table>
                        <tr>
                            <td rowspan="2" class="table-td-1">
                                <a href="#" class="discount-extraCharge-modal-show">
                                    <p>скидка:</p>
                                    <span id="discount">0</span><span> %</span>
                                    <p>надбавка:</p>
                                    <span id="extraCharge">0</span><span> %</span>
                                </a>
                            </td>
                            <td class="table-td-2">
                                <p>0005 Период 1</p>
                                <p>Основной</p>
                            </td>
                            <td class="table-td-3 first-price">
                                <p>
                                    подытог:
                                </p>
                                <span id="rawTotal">
                                    0
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class="table-td-2">
                                <p>
                                    Прейскурант для блюда
                                </p>
                            <td class="table-td-3">
                                <p class="price" id="total">0</p>
                            </td>
                        </tr>
                    </table>
                </div>
                <!--Dish quantity control-->
                <div class="left-panel-body-2">
                    <a href="#" class="add-quantity"><i class="fa fa-plus" aria-hidden="true"></i></a>
                    <a href="#" class="subtract-quantity"><i class="fa fa-minus" aria-hidden="true"></i></a>
                    <a href="#" class="quantity-control-modal-show">123</a>
                    <a href="#" class="remove-selected-dish"><i class="fa fa-times" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
        <!-- Today closed orders list -->
        <div class="today-orders-body">
            <div class="today-orders-text-headline">Номер заказа:</div>
            <div class="today-orders-text-general">Заказ открыт: </div>
            <div class="today-orders-text-general">Заказ закрыт: </div>
            <div class="today-orders-text-general">Официант: </div>
            <div class="today-orders-text-headline">Оплата</div>
            <div class="today-orders-text-general"> р.</div>
            <div class="today-orders-text-general">Банковские карты (Оплата картой): р.</div>
            <div class="today-orders-text-headline">Сдача</div>
            <div class="today-orders-text-general"> р.</div>

            <div class="today-orders-footer">
                <a href="#">
                    <div class="today-orders-button-paging item-left" >
                    <i class="fa fa-chevron-left link-left" ></i></div></a>
                <a href="#">
                    <div class="today-orders-button-paging item-right" >
                    <i class="fa fa-chevron-right link-right" ></i></div></a>
            </div>

        </div>
    </div>
    <!--футер-->
    <div class="row">
        <div class="col no-margin">
            <div class="footer">
                <div class="footer-item footer-item-1">
                    <a href="#">
                        <i class="fa fa-chevron-left" aria-hidden="true"></i>
                        <p>НАЗАД</p>
                    </a>
                </div>

                        <div class="footer-item footer-item-1 ">
                            <a data-toggle="modal" data-target="#checkModal">
                                <i class="fa fa-print" aria-hidden="true"></i>
                                <h6>ПЕЧАТАТЬ ТОВАРНЙ ЧЕК</h6>

                            </a>
                        </div>
                        <div class="footer-item footer-item-1">
                            <a href="#">
                                <i  class="fa fa-refresh" aria-hidden="true"></i>
                                <h6>ИЗМЕНИТЬ ТИП ОПЛАТЫ</h6>

                            </a>
                        </div>
                        <div class="footer-item footer-item-1">
                            <a href="#">
                                <i class="fa fa-money" aria-hidden="true"></i>
                                <h6>ЧАСТИЧНЫЙ ВОЗВРАТ ЧЕКА</h6>
                            </a>
                        </div>

            </div>
        </div>
    </div>

</section>

<!-- Check issuing modal-->
<div class="modal fade" id="checkModal" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="checkModalLabel">Способ выдачи кассового чека</div>

            <form class="form cf">

                <table class="checkModal-table">
                    <tr>
                        <td valign="bottom" style="width: 50%">
                            <section class="plan cf">
                                <!-- Print a check-->
                                <input type="radio" name="radio1" id="free" value="sendPrint" checked>
                                <label class="free-label four col" for="free">Распечатать</label>

                                <!-- Send a check by SMS-->
                                <input type="radio" name="radio1" id="basic" value="sendSms">
                                <label class="basic-label four col" for="basic">Отправить по SMS</label>

                                <!-- Send a check by E-mail-->
                                <input type="radio" name="radio1" id="premium" value="sendEmail">
                                <label class="premium-label four col" for="premium">Отправить на E-mail</label>
                            </section>
                        </td>
                        <td valign="bottom" style="width: 70%">
                            <div class="input-group input-group-lg">
                                <div class="input-group-prepend">
                                    <div class="input-group-text" id="inputTelephone">Телефон</div>
                                </div>
                                <input type="text" class="form-control" aria-label="Large" aria-describedby="inputGroup-sizing-sm">
                            </div>
                            <div class="input-group input-group-lg">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="inputEmail">Email</span>
                                </div>
                                <input type="text" class="form-control" aria-label="Large" aria-describedby="inputGroup-sizing-sm">
                            </div>
                        </td>
                    </tr>
                </table>

            <div class="modal-footer">
                <button type="submit" class="btn btn-primary btn-lg checkModal-button" >ОК</button>
                <button type="button" data-dismiss="modal" class="btn btn-primary btn-lg checkModal-button">Отмена</button>
            </div>

            </form>

        </div>
    </div>

</div>

<!-- Modal -->
<div class="modal fade bd-example-modal-sm" id="discount-extraCharge-modal" tabindex="-1" role="dialog"
     aria-labelledby="discount-extraCharge-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <p>Установите скидку/наценку</p>
                <form action="#">
                    <div class="form-group">
                        <span>Скидка:</span>
                        <input class="form-control" type="text" name="discountForm" id="discountForm" placeholder="0"
                               data-validation="number" data-validation-allowing="range[0;100]"
                               data-validation-error-msg="Укажите число от 0 до 100">
                    </div>
                    <div class="form-group">
                        <span>Наценка:</span>
                        <input class="form-control" type="text" name="extraChargeForm" id="extraChargeForm"
                               placeholder="0"
                               data-validation="number" data-validation-allowing="range[0;100]"
                               data-validation-error-msg="Укажите число от 0 до 100">
                    </div>
                    <button type="submit" class="btn btn-success">Сохранить</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                </form>
            </div>
        </div>
    </div>
</div>


<script>

    var quickMenu;

    var searchString = '';

    var options = {
        valueNames: ['nameProduct']
    };

    var listObj = new List('product1', options);

    var option2 = {
        valueNames: ['code', 'barcode', 'vendorcode']
    };

    var listObj2 = new List('products1', option2);

    var searchAll = false;
    var searchDarCode = false;
    var searchCode = false;
    var searchVendorCode = false;

    date = new Date;
    var day = date.getDay();
    if (day == 0) {
        GetQuickMenu(7);
    } else {
        GetQuickMenu(day);
    }

    function SearchProduct(value) {
        searchString = searchString + value;
        $("#SearchModalInput").val(searchString);
        listObj2.search(searchString);
    }

    function SearchProductDel() {
        searchString = '';
        $("#SearchModalInput").val(searchString);
        listObj2.search(searchString);
    }

    function SearchProductDelOne() {
        searchString = searchString.slice(0, -1);
        $("#SearchModalInput").val(searchString);
        listObj2.search(searchString);
    }


    function SearchModalЕxpandShow() {
        $("#SearchModal").modal('hide');
        $("#SearchModalЕxpand").modal('show');
        $.ajax({
            type: "POST",
            url: "/get/dish",
            beforeSend: function (xhr) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            },
            success: function (data) {
                $("#productsItem").empty();
                var dish = JSON.parse(data);
                console.log(dish);
                dish.forEach(function (value) {
                    $("#product").append("<div class=\"col-3\"><div class=\"productItem\" data-quantity=\"1\"><p class=\"nameProduct\">" + value.name + "</p><p class=\"costProduct\">" + value.price + "p</p></div></div>");
                });
                listObj = new List('product1', options);
            },
            error: function (e) {
            }
        });
    }

    function SearchModalShow() {
        $("#SearchModalЕxpand").modal('hide');
        $("#SearchModal").modal('show');
        $.ajax({
            type: "POST",
            url: "/get/dish",
            beforeSend: function (xhr) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            },
            success: function (data) {
                $("#productsItem").empty();
                var dish = JSON.parse(data);
                console.log(dish);
                dish.forEach(function (value) {
                    $("#productsItem").append("<li class=\"product-search\" data-quantity=\"1\"><p class=\"name\">" + value.name + "</p><p class=\"price\">" + value.price + "р</p><p class=\"code\">Код: " + value.code + "</p><p class=\"barcode\" style=\"display: none\">" + value.barcode + "</p><p class=\"vendorcode\" style=\"display: none\">" + value.vendorCode + "</p></li>");
                });
                listObj2 = new List('products1', option2);
            },
            error: function (e) {
            }
        });
        SearchAll();
    }

    $('#search-field').on('keyup', function () {
        var searchString = $(this).val();
        listObj.search(searchString);
    });

    function SearchModalЕxpandHide() {
        $("#SearchModal").modal('hide');
        $("#SearchModalЕxpand").modal('hide');
    }

    function SearchAll() {
        searchAll = !searchAll;
        if (searchAll) {
            $("#SearchCode").css({"background-color": "#ffff00"});
            $("#SearchDarCode").css({"background-color": "#ffff00"});
            $("#SearchVendorCode").css({"background-color": "#ffff00"});
            option2 = {
                valueNames: ['code', 'barcode', 'vendorcode']
            };
            listObj2 = new List('products1', option2);
            searchDarCode = true;
            searchCode = true;
            searchVendorCode = true;

        } else {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: []
            };
            listObj2 = new List('products1', option2);
            searchDarCode = false;
            searchCode = false;
            searchVendorCode = false;
        }
    }

    function SearchDarCode() {
        searchDarCode = !searchDarCode;
        if (searchDarCode) {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#ffff00"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: ['barcode']
            };
            listObj2 = new List('products1', option2);
            searchCode = false;
            searchVendorCode = false;
        } else {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: []
            };
            listObj2 = new List('products1', option2);
        }
    }

    function SearchCode() {
        searchCode = !searchCode;
        if (searchCode) {
            $("#SearchCode").css({"background-color": "#ffff00"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: ['code']
            };
            listObj2 = new List('products1', option2);
            searchDarCode = false;
            searchVendorCode = false;
        } else {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: []
            };
            listObj2 = new List('products1', option2);
        }
    }

    function SearchVendorCode() {
        searchVendorCode = !searchVendorCode;
        if (searchVendorCode) {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#ffff00"});
            option2 = {
                valueNames: ['vendorcode']
            };
            listObj2 = new List('products1', option2);
            searchDarCode = false;
            searchCode = false;
        } else {
            $("#SearchCode").css({"background-color": "#fff"});
            $("#SearchDarCode").css({"background-color": "#fff"});
            $("#SearchVendorCode").css({"background-color": "#fff"});
            option2 = {
                valueNames: []
            };
            listObj2 = new List('products1', option2);
        }
    }

    function GetQuickMenu(day) {
        var index = 1;
        $.ajax({
            type: "GET",
            url: "/get/quickmenu/" + day,
            beforeSend: function (xhr) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            },
            success: function (data) {
                console.log(data);
                $("#head-quick-menu").empty();
                quickMenu = data;
                quickMenu.forEach(function (value) {
                    $("#head-quick-menu").append("<li><a href=\"#\" onclick=\'ChangeQuickMenu(" + index + ")\' id=\"headerQuickMenu-" + index + "\">" + value.name + "</a></li>");
                    index = index + 1;
                });

                $(".right-panel-body-1").empty();
                $(".right-panel-body-2").empty();
                $(".right-panel-body-3").empty();

                quickMenu[0].dishQuickMenu.forEach(function (value) {
                    console.log(value);
                    if (value.position == 1) {
                        $(".right-panel-body-1").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
                    }
                    if (value.position == 2) {
                        $(".right-panel-body-2").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
                    }
                    if (value.position == 3) {
                        $(".right-panel-body-3").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
                    }

                });

                headerQuickMenu(1);
            },
            error: function (e) {
            }
        });
    }

    function ChangeQuickMenu(numMenu) {
        headerQuickMenu(numMenu)
        $(".right-panel-body-1").empty();
        $(".right-panel-body-2").empty();
        $(".right-panel-body-3").empty();
        quickMenu[numMenu - 1].dishQuickMenu.forEach(function (value) {
            if (value.position == 1) {
                $(".right-panel-body-1").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
            }
            if (value.position == 2) {
                $(".right-panel-body-2").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
            }
            if (value.position == 3) {
                $(".right-panel-body-3").append("<a class=\"middle-panel-yellow\" style=\"background-color: " + value.color + " \" href=\"#\">" + value.dish[0].name + "</a>");
            }
        });
    }

    function headerQuickMenu(num) {
        var id = "#headerQuickMenu-" + num;
        $("#headerQuickMenu-1").css({"background-color": "#3e4040", "color": "#fff"});
        $("#headerQuickMenu-2").css({"background-color": "#3e4040", "color": "#fff"});
        $("#headerQuickMenu-3").css({"background-color": "#3e4040", "color": "#fff"});
        $(id).css({"background-color": "#dfe487", "color": "#3e4040"});
    }

</script>
</body>
</html>









